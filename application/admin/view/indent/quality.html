{extend name="index_layout"/}
{block name="main"}
<link rel="stylesheet" type="text/css" href="/static/layui/layui-v2.5.6/layui.css" />


<style>
    input{
        line-height:30px;
        display:inline;
        width: 500px;
        margin:  0 30px;
    }
</style>
<div style="width: 100%;margin: 0 auto;border:1px solid #DDDDDD;display: flex;background-color: white">

    <div class="information-box" style="border:1px solid #DDDDDD; width: 250px;">
        <div >
            <button type="button" class="layui-btn" onclick="javascript:window.location.href='/admin/indent/create'"/>新增子标题</button>
        </div>
        <div id="test1" class="demo-tree demo-tree-box" style="height: 700px"></div>
    </div>
    <div style="width: 100%;height:800px;border:1px solid #DDDDDD;">
        <form id="form1">
            <input type="hidden"value="" id="tid" name="id">
            <span style="color: #2bf678;font-size: 20px " id="title2">标题:</span>   <input type="text" value="" id="title" name="title">
            <div>
                <div id="editor">
                </div>
            </div>
            <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
            <button class="layui-btn" lay-submit lay-filter="del">删除该文章</button>
        </form>
    </div>

</div>

{/block}
{block name="script"}
<script type="text/javascript" src="__STATIC__/admin/js/common.js"></script>
<script src="https://www.layuicdn.com/layui/layui.js"></script>
<script type="text/javascript" src="http://unpkg.com/wangeditor/release/wangEditor.min.js"></script>
<script src="__STATIC__/12/admin/js/jquery-2.0.0.js"></script>

<!--<script src="https://www.layuicdn.com/layer/layer.js"></script>-->
<script>
    layui.use(['tree', 'util'], function () {
        var E = window.wangEditor
        var editor = new E('#editor')
        editor.create()
        var tree = layui.tree
            , layer = layui.layer
            , util = layui.util
        function funName(){
            $.ajax({
                type: "get",
                url: "/admin/indent/calendar",
                // async:false,
                success: function (e) {
                    da=e;
                    tree.render({
                        elem: '#test1' //默认是点击节点可进行收缩
                        , data: da
                        ,spread: true//默认展开无效????
                        ,showLine: false
                        ,click: function(obj){
                            console.log(obj.data); //得到当前点击的节点数据
                            var  id =obj.data.id;
                            $(".layui-tree-set").css('background',"none");
                            $(".layui-tree-set[data-id= "+id+" ]").css('background',"#ad7d7d");

                            // $('#title').attr('value',obj.data.title);
                            $.ajax({
                                type: "post",
                                url: "/admin/indent/one",
                                data:{id:obj.data.id},
                                success: function (e) {
                                    console.log(e.title);
                                    editor.txt.html(e.content);
                                    $('#title').remove();
                                    $('#title2').append(' <input type="text" value="" id="title" name="title">')
                                    $("#title").attr('value',e.title);
                                    $("#tid").attr('value',e.id);
                                },
                            })


                        }
                    });
                }
            });
        }
        funName();
        layui.use('form', function(){
            var form = layui.form;
            //监听提交
            form.on('submit(formDemo)', function(data){
                // layer.msg(JSON.stringify(data.field));
                var html = editor.txt.html();
                var id= $('#tid').val();
                var title= $('#title').val();
                console.log(html);
                console.log(id);
                console.log(title);
                $.ajax({
                    type: "post",
                    url: "/admin/indent/update",
                    data:{id:id,title:title,content:html},
                    success: function (e) {
                        layer.msg(e.msg);
                        funName();
                    },
                })
                return false;
            });
            form.on('submit(del)', function(data){
                var id= $('#tid').val();
                $.ajax({
                    type: "post",
                    url: "/admin/indent/del",
                    data:{id:id},
                    success: function (e) {
                        layer.msg(e.msg);
                        funName();
                    },
                })
                return false;
            });
        });
    });





</script>
{/block}